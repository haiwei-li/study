
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1. 简单替换表达式](#1-简单替换表达式)
- [2. 正则表达式](#2-正则表达式)
  - [2.1. 元字符](#21-元字符)
    - [2.1.1. 一些普通字符需转意](#211-一些普通字符需转意)
    - [2.1.2. 表示数量的元字符](#212-表示数量的元字符)
    - [2.1.3. 表示位置的元字符](#213-表示位置的元字符)
  - [2.2. 替换变量](#22-替换变量)

<!-- /code_chunk_output -->

# 1. 简单替换表达式

```
:[range]s/from/to/[flags]
```

range:搜索范围, 如果没有指定范围, 则作用于当前行.

- `:1,10s/from/to/` 表示在第 1 到第 10 行(包含第 1, 第 10 行)之间搜索替换;
- `:10s/from/to/` 表示只在第 10 行搜索替换;
- `:%s/from/to/` 表示在所有行中搜索替换;
- `:1,$s/from/to/` 同上.

flags 有如下四个选项:

- `c` confirm, 每次替换前询问;
- `e` error,  不显示错误;
- `g` globle, 不询问, 整行替换. 如果不加 g 选项, 则只替换每行的第一个匹配到的字符串;
- `i` ignore, 忽略大小写.

这些选项可以合并使用, 如 cgi 表示不区分大小写, 整行替换, 替换前询问.

# 2. 正则表达式

## 2.1. 元字符

```
元字符	   说明
.          匹配任意字符
[abc]	   匹配方括号中的任意一个字符, 可用-表示字符范围. 如[a-z0-9]匹配小写字母和数字
[^abc]	   匹配除方括号中字符之外的任意字符
\d         匹配阿拉伯数字, 等同于[0-9]
\D         匹配阿拉伯数字之外的任意字符, 等同于[^0-9]
\x         匹配十六进制数字, 等同于[0-9A-Fa-f]
\X         匹配十六进制数字之外的任意字符, 等同于[^0-9A-Fa-f]
\l         匹配[a-z]
\L         匹配[^a-z]
\u         匹配[A-Z]
\U         匹配[^A-Z]
\w         匹配单词字母, 等同于[0-9A-Za-z_]
\W         匹配单词字母之外的任意字符, 等同于[^0-9A-Za-z_]
\t         匹配<TAB>字符
\s         匹配空白字符, 等同于[\t]
\S         匹配非空白字符, 等同于[^\t]
```

### 2.1.1. 一些普通字符需转意

```
元字符	   说明
\*         匹配* 字符
.          匹配. 字符
\/         匹配 / 字符
\          匹配 \ 字符
\[         匹配 [ 字符
\]         匹配 ] 字符
```

### 2.1.2. 表示数量的元字符

```
元字符	   说明
*          匹配 0-任意个
\+         匹配 1-任意个
\?         匹配 0-1 个
\{n,m}     匹配 n-m 个
\{n}       匹配 n 个
\{n,}	   匹配 n-任意个
\{,m}	   匹配 0-m 个
```

### 2.1.3. 表示位置的元字符

```
元字符	   说明
$          匹配行尾
^          匹配行首
\<         匹配单词词首
\>         匹配单词词尾
```

## 2.2. 替换变量

在正则式中以\(和\)括起来的正则表达式, 在后面使用的时候可以用\1、\2 等变量来访问\(和\)中的内容.

例子

```
删除行尾空格: :%s/\s+$//g
删除行首多余空格: %s/^\s*// 或者 %s/^ *//
删除沒有內容的空行: %s/^$// 或者 g/^$/d
删除包含有空格组成的空行: %s/^\s*$// 或者 g/^\s*$/d
删除以空格或 TAB 开头到结尾的空行: %s/^[ |\t]*$// 或者 g/^[ |\t]*$/d
```

把文中的所有字符串"abc......xyz"替换为"xyz......abc"可以有下列写法

```
:%s/abc\(.*\)xyz/xyz\1abc/g
:%s/\(abc\)\(.*\)\(xyz\)/\3\2\1/g
```