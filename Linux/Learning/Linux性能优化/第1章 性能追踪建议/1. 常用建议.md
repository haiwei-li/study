
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1. 记大量的笔记(记录所有的事情)](#1-记大量的笔记记录所有的事情)
  - [1.1. 收集和记录的信息](#11-收集和记录的信息)
    - [1.1.1. 硬件/软件配置信息](#111-硬件软件配置信息)
    - [1.1.2. 保存并组织性能测试结果](#112-保存并组织性能测试结果)
    - [1.1.3. 记录命令行调用](#113-记录命令行调用)
    - [1.1.4. 记录研究的所有信息和相关 URL](#114-记录研究的所有信息和相关-url)
  - [1.2. 收集和记录信息的必要性](#12-收集和记录信息的必要性)
    - [1.2.1. 结果含义的不明确致使需要反复审视](#121-结果含义的不明确致使需要反复审视)
    - [1.2.2. 所有信息都是有用的](#122-所有信息都是有用的)
    - [1.2.3. 回顾可以得到新想法](#123-回顾可以得到新想法)
    - [1.2.4. 保持过程的可靠性和一致性](#124-保持过程的可靠性和一致性)
- [2. 自动执行重复任务](#2-自动执行重复任务)
  - [2.1. 性能工具调用](#21-性能工具调用)
  - [2.2. 应用程序测试](#22-应用程序测试)
  - [2.3. 举例](#23-举例)
- [3. 尽可能选择低开销工具](#3-尽可能选择低开销工具)
- [4. 使用多个工具来搞清楚问题](#4-使用多个工具来搞清楚问题)
- [5. 相信你的工具](#5-相信你的工具)
- [6. 利用其他人的经验(慎重)](#6-利用其他人的经验慎重)

<!-- /code_chunk_output -->

# 1. 记大量的笔记(记录所有的事情)

调查性能问题, **最重要**的事情是记录下看到的**每一个输出**、执行的**每一条命令**, 以及研究的**每一个信息**.

性能调查之前, 我通常**创建一个目录**, 打开一个**新文件**, 开始记录**系统的信息**. 之后, 将**性能结果**保存到**这个目录**, 并将**相关的信息**保存到**这个文件**.

## 1.1. 收集和记录的信息

建议将下面的内容添加到你的性能调查**文件**和**目录**中:

### 1.1.1. 硬件/软件配置信息

* 记录**硬/软件**的**配置情况**

记录下的信息包括**硬件配置**(**主存容量**、**CPU 类型**、**网络**和**磁盘子系统**)和**软件环境**(OS 和软件的版本、相关配置文件).

在追踪问题时, 可能会大幅度地修改系统配置.

示例: **每次测试时(不仅仅是最开始**), 保存`lspci -vvvb`、`dmesg`和`uname -a`的输出.

### 1.1.2. 保存并组织性能测试结果

* 保存并组织性能测试结果

记录系统配置的同时, 也记录**测试结果**. 这使你得以比较**不同的配置**是**如何影响性能结果**的.

### 1.1.3. 记录命令行调用

* 写下命令行调用

如果想重新测试, 或在不同的应用程序上运行相同的测试, 复制这些命令行困难且容易出错.

Linux 命令`script`是个好方法.

### 1.1.4. 记录研究的所有信息和相关 URL

* 记录研究的信息和 URL

**调查性能问题**时, 将**研究信息记录**下来, 无论是**网上发现**的、**电子邮件询问**、还是**通过其他人询问**. 要将**内容复制粘贴**到笔记中. (网站是会消失的)

当然, 还要记录下**URL**.

## 1.2. 收集和记录信息的必要性

上面让收集和记录的信息是很有必要的, 有些信息眼下显得毫无作用或有误导性, 但它在将来可能是有用的.

(好的性能调查就像一部优秀的侦探剧: 尽管开始的时候所有的线索都令人迷惑, 但最终都会真相大白. )

在调查问题时, 请牢记以下几点:

### 1.2.1. 结果含义的不明确致使需要反复审视

* 结果的含义可能是不明确的

性能工具给你的信息并不总是清晰明了的. 往往需要反复审视记录的信息.

### 1.2.2. 所有信息都是有用的

* 所有的信息都是有用的(这也就是你要记录的原因)

通过记录和整理调查过程中你所见的一切, 就有足够证据**支持特定理论**, 同时也具备大量的测试结果来证明或驳斥其他理论.

### 1.2.3. 回顾可以得到新想法

* 定期回顾你的笔记可以得到新的想法

重新审视会让你关注结果, 而不是测试. 当许多测试结果放在一起被同时查看时, 问题的原因也许就会自动浮现. 回顾你收集的数据, 就可以在不实际运行任何测试的情况下进行理论检验.

### 1.2.4. 保持过程的可靠性和一致性

可以**避免重复运行测试**以及**重复研究**. 保持过程的可靠性和一致性.

例如, 发现是硬件问题, 就能根据**之前的配置和测试过程**为**新硬件**进行**测试设置以及运行测试**, 同时也可以比较新的结果与保存的旧结果. 因为可能过了很长时间.

# 2. 自动执行重复任务

输入复杂命令容易出错, 有些不正确参数和配置容易导致误导性信息.

因此, 自动执行**性能工具调用！！！** 和**应用程序测试！！！** 是一个好办法: ·

## 2.1. 性能工具调用

* 性能工具调用

有些 Linux**性能工具的命令行**相当复杂, 把它们保存到一个**shell 脚本**中, 或是**将所有命令保存到文件**中.

## 2.2. 应用程序测试

* 应用程序测试

**大部分应用程序**有着**复杂的配置**, 要么通过**命令行**, 要么通过**配置文件**. 将测试调用保存为**脚本**.

## 2.3. 举例

**尽可能**多地**自动执行**, 就能**减少错误**. 使用**脚本自动执行**, 可以**节省时间**.

举个例子, 你想在**特定工作负载**下或**某段时间**内**监控系统**, 但是在**测试结束时**, 你**可能不在现场**.

这种情况下, 脚本就很好用了, 在**测试完成时**, 可以**自动收集**、**命名**、**保存**全部生成的**性能数据**, 并将它们自动放到"Results"目录中.

有了这些基础之后, 你就能按照**不同的优化和调整重新运行测试**, 并且不用担心数据**是否已经保存好**.

# 3. 尽可能选择低开销工具

一般情况下, **观察系统**会**修改系统的行为**. (对物理爱好者来说, 这就是**海森堡(Heisenberg)不确定性原理**)

具体而言, 在使用性能工具时, 它们会改变系统的行为方式.

# 4. 使用多个工具来搞清楚问题

比如, **一种性能工具**会告诉你系统存在**大量的磁盘 I/O**, 而另一种工具则告诉你系统**使用了大量的交换**.

如果**只以第一个工具**的结论制定解决方案, 你可能会简单地**选择更快的磁盘驱动器**(然后发现性能问题仅仅改善了一点点).

而将**两种工具**的结果放在一起, 你就会判断出: **大量的磁盘 I/O**是由**大量使用的交换造成**的. 在这种情况下, 你可能会**买更多的主存以减少交换**(这样就不会再有大量的磁盘 I/O).

比起单一地使用任何一种工具, **同时使用多个性能工具**通常能让你对性能问题有更清晰的了解.

寓言: 盲人摸象

# 5. 相信你的工具

# 6. 利用其他人的经验(慎重)

