为了避免处理复杂的中断嵌套, 中断处理程序是在关闭中断的情况下执行的. 可是, 如果关闭中断的时间太长, 可能导致中断请求丢失. 例如周期时钟每隔 10 毫秒发送一个中断请求, 如果执行某个中断处理程序花费的时间超过 10 毫秒, 在这段时间里时钟发送了两个中断请求, 但是处理器只认为收到一个时钟中断请求.

最激进的解决办法是中断线程化, 但是常用的解决办法是: 把中断处理程序分为两部分, 上半部 (top half, th) 在关闭中断的情况下执行, 只做对时间非常敏感, 与硬件相关或者不能被其他中断打断的工作; 下半部 (bottom half, bh) 在开启中断的情况下执行, 可以被其他中断打断.

上半部称为硬中断 (hardirq)​, 下半部有 3 种: 软中断(softirq)​, 小任务(tasklet) 和工作队列(workqueue)​.3 种下半部的区别如下.

(1)软中断和小任务不允许睡眠; 工作队列是使用内核线程实现的, 处理函数可以睡眠.

(2)软中断的种类是编译时静态定义的, 在运行时不能添加或删除; 小任务可以在运行时添加或删除.

(3)同一种软中断的处理函数可以在多个处理器上同时执行, 处理函数必须是可以重入的, 需要使用锁保护临界区; 一个小任务同一时刻只能在一个处理器上执行, 不要求处理函数是可以重入的.
