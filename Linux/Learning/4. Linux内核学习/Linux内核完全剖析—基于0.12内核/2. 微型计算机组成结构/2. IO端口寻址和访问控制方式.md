-  I/O 端口寻址和访问控制方式

    - 1. I/O 端口和寻址

    - 2. 接口访问控制

## 1. I/O 端口和寻址

参考: ComputerArchitecture/IO 端口和寻址

CPU 为访问 I/O 接口控制器或控制卡上的数据和状态信息, 需要首先指定它们的地址. 这种地址称为 I/O 端口地址或简称端口. 通常, 一个 I/O 控制器包含访问数据的数据端口、输出命令的命令端口和访问控制器执行状态的状态端口. 端口地址的设置方法一般有两种: 统一编址和独立编址.

- 统一编址: 把 I/O 控制器中端口地址归入存储器寻址地址空间范围内(并不是说在内存条给空间). CPU 访问一个端口与访问内存一样, 也**使用访问内存的指令**. 这种编址方式也称存储器映像编址.

- 独立编址: 把 I/O 控制器/控制卡的寻址空间单独作为一个独立的地址空间对待, 称为 I/O 地址空间. 每个端口有一个 I/O 地址与之对应, 并且**使用专门的 I/O 指令来访问端口**.

IBM PC 及兼容机主要使用独立编址. 使用 ISA 总线结构的传统 PC, 其 I/O 地址空间针对不同控制器/控制卡有默认分配范围. 一段 I/O 地址分配给一个控制器/控制卡, 比如 0x000 ~ 0x01F 分配给 8237A DMA 控制器 1、0x1F0 ~ 0x1F7 分配给 IDE 硬盘控制器 0.

也有部分使用统一编址. 例如, CGA 显示卡上显示内存的地址就直接占用存储器地址空间范围. 因此若要让一个字符显示在屏幕上, 可以直接使用内存操作指令往这个内存区域写.

Linux 中通过查看 **/proc/ioports** 文件**查看**相关控制器或**设置**使用的 I/O 地址范围.

## 2. 接口访问控制

PC 的 I/O 接口数据传输**控制方式**一般可采用程序循环查询方式、中断处理方式和 DMA 传输方式.

- **程序循环查询方式**: CPU 通过在程序中循环查询指定设备控制器中的状态判断是否与设备进行数据交换. 不需过多硬件支持, 但耗费 CPU 时间. Linux 中, 只有在设备或控制器能**立即返回信**息才在**很少**地方采用.

- **中断**: 需要**中断控制器**的支持. 只有当 I/O 设备通过中断向 CPU 提出处理请求时, CPU 才会暂时中断当前执行的程序转而执行相应的 I/O 中断处理服务过程. 当执行完该中断处理服务过程后, CPU 会继续执行刚才被中断的程序. 当 CPU 接收到中断时, CPU 会通过使用**中断向量表**(或中断描述符表)来寻址相应的中断处理服务过程的入口地址. 因此这种方式需要**首先设置好中断向量表**, 并**编制好相应的中断处理服务过程**. Linux 中**大多设备 I/O**控制都采用中断处理方式.

- 直接存储器访问(Direct Momery Access, DMA): 用于 I/O 设备与系统内存之间进行批量数据传送, 整个操作过程需要使用专门的**DMA 控制器**来进行而无需 CPU. Linux 中, 软盘驱动程序使用中断和 DMA 方式来配合实现数据传输.