linux eBPF 是 3.17 内核开始引入的一个全新设计, 代码目录主要在 kernel/bpf 下, 它的全称是 extended BPF(eBPF),  目前关于 eBPF 的资料还比较乱, 很难得看到一篇对 ebpf 总结的那么全的文章, 转载自此:

译自: https://qmonnet.github.io/whirl-offload/2016/09/01/dive-into-bpf/ 作者:  Quentin Monnet

原创: LCTT https://linux.cn/article-9507-1.html 译者:  qhwdw

# 什么是 BPF?

BPF, 即**伯克利包过滤器**(Berkeley Packet Filter), 最初构想提出于 1992 年, 其目的是为了提供一种**过滤包**的方法, 并且要**避免**从**内核空间**到**用户空间**的**无用的数据包复制行为**.

它**最初**是由**从用户空间注入到内核**的一个**简单的字节码**构成, 它在那个位置利用一个**校验器**进行**检查**(以避免**内核崩溃**或者**安全**问题)并**附着**到一个**套接字**上, 接着在**每个接收到的包上运行**.

几年后它被移植到 Linux 上, 并且应用于一小部分应用程序上(例如, tcpdump). 其简化的语言以及存在于内核中的**即时编译器**(`JIT`), 使 BPF 成为一个性能卓越的工具.

然后, 在 2013 年, Alexei Starovoitov 对 BPF 进行彻底地**改造**, 并增加了新的功能, 改善了它的性能. 这个新版本被命名为 **eBPF** (意思是 "extended BPF"), 与此同时, 将**以前的 BPF** 变成 **cBPF**(意思是 "classic" BPF). **新版本**出现了如**映射**和**尾调用 tail call**这样的新特性, 并且 **JIT 编译器**也**被重写**了. **新的语言**比 cBPF 更接近于**原生机器语言**. 并且, 在内核中创建了**新的附着点**.

感谢那些**新的钩子**, eBPF 程序才可以被设计用于各种各样的情形下, 其分为**两个应用领域**.

* 其中一个应用领域是**内核跟踪**和**事件监控**. BPF 程序可以**被附着到探针**(kprobe), 而且它与其它跟踪模式相比, 有很多的优点(有时也有一些缺点).

* 另外一个应用领域是**网络编程**. 除了套接字过滤器外, eBPF 程序还可以附加到 tc(Linux 流量控制工具)的入站或者出站接口上, 以一种很高效的方式去执行各种包处理任务. 这种使用方式在这个领域开创了一个新的天地.

并且 eBPF 通过使用为 `IO Visor` 项目开发的技术, 使它的性能进一步得到提升: 也为 XDP("eXpress Data Path")添加了新的钩子, XDP 是不久前添加到内核中的一种新式快速路径. XDP 与 Linux 栈组合, 然后使用 BPF , 使包处理的速度更快.

甚至一些项目, 如 P4、Open vSwitch, [考虑](http://openvswitch.org/pipermail/dev/2014-October/047421.html) 或者开始去接洽**使用 BPF**. 其它的一些, 如 CETH、Cilium, 则是完全基于它的. BPF 是如此流行, 因此, 我们可以预计, 不久之后, 将围绕它有更多工具和项目出现 ...

# 深入理解字节码

就像我一样: 我的一些工作(包括 BEBA)是非常依赖 eBPF 的, 并且在这个网站上以后的几篇文章将关注于这个主题. 按理说, 在深入到细节之前, 我应该以某种方式去介绍 BPF —— 我的意思是, 真正的介绍, 在第一节所提供的简要介绍上更多地介绍在 BPF 上开发的新功能: 什么是 BPF 映射?尾调用?内部结构是什么样子?等等. 但是, 在这个网站上已经有很多这个主题的介绍了, 而且, 我也不希望去写另一篇 "BPF 介绍" 的重复文章.

毕竟, 我花费了很多的时间去阅读和学习关于 BPF 的知识, 因此, 在这里我们将要做什么呢, 我收集了非常多的关于 BPF 的阅读材料: 介绍、文档, 也有教程或者示例. 这里有很多的材料可以去阅读, 但是, 为了去阅读它, 首先要去 找到 它. 因此, 为了能够帮助更多想去学习和使用 BPF 的人, 现在的这篇文章给出了一个资源清单. 这里有各种阅读材料, 它可以帮你深入理解内核字节码的机制.

# 资源

## 简介


