
SMMU 存在三个软件可用的接口:

基于内存的数据结构用来将设备映射到转换表,这些转换表用来转换 client 设备的地址;
基于内存的环形缓冲队列.对于 SMMU,存在一个命令队列,一个用于记录 event 和 fault 的 Event 队列,一个用于 PCIE 页请求的 PRI 队列;
一组寄存器用于 discovery 和 SMMU 全局的配置,部分仅安全;

这些寄存器指明了数据结构和队列的基地址,提供了特性的发现和识别,提供了全局控制寄存器用来使能事务的处理.当支持安全时,另外一组寄存器允许安全软件来维护设备结构,往安全的命令队列发送命令,从安全 Event 队列中读取安全事件.

在允许 stage1 转换在虚拟化场景下,guest OS 提供了相同的编程接口,因此认为它也是在真实的 SMMU 控制下(相同格式的命令, Event,PRI,队列和内存中数据结构).

在 SMMU 的寄存器和结构的某些域被标记为实现定义.这些域的内容是 SMMU 特有的,但实现不能使用这些域,这样使 SMMUV3 驱动可用.若驱动没有扩展某些实现和特性,驱动必须将这些域看着保留并设置为 0.实现只能使用实现定义的域来扩展功能和特性,当这些域设置为 0 时实现保持与通用驱动软件兼容.

https://blog.csdn.net/flyingnosky/article/details/122008184