
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [可用性含义](#可用性含义)
- [虚拟机技术如何提高可用性](#虚拟机技术如何提高可用性)
- [虚拟机技术带来的新契机](#虚拟机技术带来的新契机)
- [案例分析: VMware HA 和 LUCOS](#案例分析-vmware-ha-和-lucos)

<!-- /code_chunk_output -->

# 可用性含义

传统可用性包括易用性和实用性两个方面, 易用性即衡量使用一种产品来执行指定任务的难易程度的尺度, 实用性则包括功能的有用性和多样性. 一个产品, 功能越多, 并且这些功能会被使用, 则实用性就越高.

计算机领域, 我们所谈的可用性是指通过尽量缩短因日常维护(计划)或突发系统崩溃(非计划)所导致的停机, 使系统不间断地向外界提供服务, 其理想状态是零停机, 即没停机时间.

# 虚拟机技术如何提高可用性

系统停机两种情况:

- 第一种是软件出错. 客观存在且必然存在, 并且在可预见的未来这种出错是不可避免.

- 第二种是硬件出错. 客观存在且不可避免.

传统高可用性方案致力于在系统发生不可避免停机时, 能在最短的时间内实现服务的恢复. 为达到这个目标, 其 IT 基础构造需要保证每一台计算机必须有一台镜像, 使用群集软件将计算机设置为互相镜像. 一般情况下, 由主虚拟机向镜像发送心跳信号, 当主虚拟机发生故障, 镜像接收不到心跳信号时, 将由镜像接管主虚拟机工作. 这种方法确实可以保证系统崩溃时的快速恢复, 而且此方法在硬件出错和软件出错时同样有效.

但这个方法有显而易见的缺点, 每个计算机都需要一个镜像, 对资源的极大浪费, 而且镜像管理将会大量人力, 即此方法是资源密集型和劳动密集型的. 而且此方法要求镜像机和主虚拟机在硬件配置上完全一样, 故只有少数公司在实际生产中使用这种方法.

# 虚拟机技术带来的新契机

利用虚拟机技术, 可以将多个物理资源抽象成和硬件无关的虚拟资源, 而硬件资源则像放在池子中的物件一样, 由 VMM 分配虚拟资源, 也称共享资源池.

虚拟机则运行在这些虚拟资源上, VMM 动态监控虚拟机内部的 OS 和应用的运行状态, 如果崩溃, 则在相应服务节点重启虚拟机, 从而实现**软件出错**的快速恢复能力.

同时, VMM 会动态监测物理节点的可用性, 如果某个物理节点失效, 则在另外可用的物理节点上重新启动所有受到此物理节点影响的虚拟机, 从而实现**硬件出错**的快速恢复能力.

因为物理资源被抽象为和硬件无关的虚拟资源, 故使用基于虚拟化技术的恢复方法不受硬件不同的限制, 并且在没有出现需要重启某个虚拟机的情况下, 所有资源都可以被利用起来, 保证资源的利用率. 当需要重启某个虚拟机时候, VMM 动态减少已经存在的虚拟机资源, 在有**空闲资源**的**物理节点**上**重启虚拟机**. 并且在**重新启动新的虚拟机**后, 可以**使用虚拟机动态迁移技术重新分配虚拟机**, 已达到工作的**负载平衡**.

总的来说, 使用基于虚拟机的恢复技术有以下优点.

1) 资料利用率得到保证, 没有传统的资源浪费情况, 因此此种方法不是资源密集型的.

2) 一切都可交给 VMM 管理, 因此此种方法不是劳动密集型的.

3) 利用虚拟机动态迁移技术在故障恢复后重新分配资源, 能获得当前状态下最优的资源分配策略.

4) 当出错的硬件主机得以修复并重新工作, 或者有新的主机想加入资源池时, 可以很方便地加入, 再通过虚拟机迁移技术重新分配资源, 使新加入的物理机能很快利用起来.

此外, 通过虚拟化技术, 可以实现在线的硬件资源升级, 使得日常维护(计划)不需要停机, 具体做法如下.

1) 将需要更新的物理机上的虚拟机使用虚拟机动态迁移技术迁移到其它物理机上.

2) 此物理机退出, 然后更新硬件并重新加入集群.

3) 使用虚拟机动态迁移技术动态分配虚拟机, 以达到资源负载均衡

# 案例分析: VMware HA 和 LUCOS

