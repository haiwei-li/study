
> Overview

# 虚拟化背景

虚拟化允许系统软件 VMM 创建多个有独立执行环境的虚拟机(VM), 操作系统和应用进程可以在其中运行. 虚拟化广泛用于企业和云数据中心, 作为一种机制, 将多个工作负载集成到单个物理计算机上, 同时使它们彼此隔离.

容器是**另一种类型**的**隔离环境**, 用于**打包和部署应用**并在**隔离环境**中**运行**它们. 容器可以构造为实例化为 OS 进程组的裸机容器, 也可以构造为利用硬件支持的增强隔离属性进行虚拟化的计算机容器. 容器比虚拟机重量轻, 并且可以以更高的密度部署, 这可能会将系统上隔离环境的数量增加一个数量级. 本文档主要将独立域称为 VM, 但这些原则也适用于其他域抽象, 例如容器.

新式处理器提供的功能可减少虚拟化开销, VMM 可以利用这些功能允许 VM 直接访问硬件资源.

* 英特尔虚拟化技术(Intel VT-x)定义了英特尔处理器硬件功能, 以减少 **CPU** 和 **MEM** 虚拟化的开销.

* Intel VT-d 定义了用于**直接内存访问**(DMA)和**中断**的**重新映射**和**隔离**的平台硬件功能, 可用于最大限度地减少 I/O 虚拟化的开销.

**I/O 虚拟化**是指**跨**多个**虚拟机**或**容器**实例的 I/O 设备的虚拟化和共享. 现有的 I/O 虚拟化有多种方法, 可以大致分为基于软件的或硬件辅助的.

使用**基于软件的 I/O 虚拟化**, VMM 向 VM 公开**虚拟设备**, 例如网络接口控制器(`Network Interface Controller`, NIC). VMM 中的**软件设备模型**模拟虚拟设备的行为. 设备模型从虚拟设备命令转换为转发到物理设备的物理设备命令. 设备的此类软件模拟可以为 VM 中运行的软件提供良好的兼容性, 但会产生显着的**性能开销**, 尤其是对于高性能设备. 除了性能限制之外, 对于图形处理单元(**GPU**)和现场可编程门阵列(**FPGA**)等可编程设备, 在**软件**中**仿真虚拟设备**可能很**复杂**, 因为这些设备执行各种复杂的功能.

基于软件的 I/O 虚拟化的变体(如 "device paravirtualization**设备半虚拟化**" 和 "mediated pass-through**中介直通**")可以减轻设备仿真的一些性能和复杂性缺点.

为了避免基于软件的 I/O 虚拟化的开销, VMM 可以利用对 **DMA 和中断重映射**的**硬件平台支持**(如 Intel VT-d)来支持 "direct device assignment**直接设备分配**", 这允许 guest 软件直接访问分配的设备. 直接设备分配可提供**最佳的 I/O 虚拟化性能**, 因为虚拟机管理进程不再位于大多数来宾软件访问设备的路径中. 但是, 此方法要求**将设备独占分配给 VM**, 并且**不支持**在多个 VM 之间**共享设备**.

Single Root I/O Virtualization(SR-IOV) 是针对硬件辅助 I/O 虚拟化定义的 PCI-SIG 规范, 它定义了对 endpoint 设备进行分区以在多个虚拟机或容器之间直接共享的标准方法. 支持 SR-IOV 的端点设备支持物理功能 (PF) 和多个虚拟功能 (VF). PF 为设备提供资源管理, 并由主机操作系统中运行的主机驱动进程管理. 可以将每个 VF 分配给 VM 或容器以进行直接访问. SR-IOV 由高性能 I/O 设备(如网络和存储控制器设备)以及可编程或可重新配置的设备(如 GPU、FPGA 和其他加速器)提供支持.

# SIOV

>Intel® Scalable I/O Virtualization, Intel 可扩展 I/O 虚拟化

Intel SIOV 是一种**硬件辅助 I/O 虚拟化**方法, 可实现跨隔离域的高度可扩展和高性能 I/O 设备共享, 同时控制端点设备硬件的成本和复杂性, 以支持此类可扩展共享.


