
QEMU程序在运行时提供了一个所谓的监控器(monitor)来跟外界进行数据交互. QEMU monitor有很多功能, 如得到虚拟机运行的一些统计信息、进行设备的热插拔、动态设置一些参数、开启一些功能等. QEMU monitor能够使用多种方式进行交互, 如QEMU的控制台、TCP网络、UNIX套接字、文件等.

与QEMU monitor进行交互的协议有两类, 传统的是基于字符串的协议, 叫作Human Monitor Protocol(HMP), 其功能比较简单, 可用于进行简单的调试和查看虚拟机状态等. 其基本原理如图2-23所示.

hmp原理:

![2024-06-23-00-31-45.png](./images/2024-06-23-00-31-45.png)

另一个协议是QEMU Monitor Protocol(qmp), 它是一个基于json、用来与QEMU进行交互的协议, 采用典型的服务器-客户端架构. 通过qmp, 上层管理软件可以很方便地对QEMU虚拟机进行管理, 如virsh就能够使用qmp对虚拟机进行管理. qmp原理如图2-24所示.

qmp原理:

![2024-06-23-00-32-13.png](./images/2024-06-23-00-32-13.png)

现在的QEMU底层其实都是通过qmp完成功能的, 只是还保留了hmp的接口.

从 `hmp原理` 图可以看出, hmp是针对人的, 所以采用了基于"info xxx"等简单易记字符串的协议, 而qmp主要是针对机器和其他程序的, 所以采用了更加规范的json格式来传递数据.

