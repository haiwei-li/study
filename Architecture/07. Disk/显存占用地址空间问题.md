参考:

http://blog.csdn.net/vigour_lu/article/details/1966672

要求配置的机子内存为 3G 显存 1G 由于显存和内存的容量都比较大担心显存会占用内存的地址空间导致内存的容量并不会被全部的使用. 关于这个问题的讨论分为以下三个部分: 显存否会占用地址空间; 显存是否会占用内存的地址空间; 如何解决这个问题.

## 1. 显存否会占用地址空间

要回答这个问题必须要先了解两个概念: "物理内存"和"地址空间".

- "物理内存". 一般常说的物理内存就是指安装在主板上的内存条其实不然在计算机的系统中**物理内存**不仅包括装在主板上的**内存条**(RAM)还应该包括主板**BIOS 芯片的 ROM**显卡上的**显存**(RAM)和**BIOS**(ROM)以及各种**PCI、PCI-E 设备**上的 RAM 和 ROM.

- "地址空间". **地址空间就是对物理内存编码(地址编码)的范围**. 所谓**编码就是对每一个物理存储单元(一个字节)分配一个唯一的地址号码这个过程又叫做"编址"或者"地址映射"**. 与编码相对应的是"寻址"过程———分配一个地址号码给一个存储单元的目的是为了便于找到它完成数据的读写这就是"寻址"因此地址空间有时候又被称作"寻址空间". **系统不仅要给主板上的内存条编址还要给上述的其它物理内存编址**; 它们都被编在同一个地址空间内编址后的物理内存就可以被系统资源使用或占用.

通过以上分析可知显存将占用地址空间.

## 2. 显存是否会占用内存的地址空间

要回答这个问题要从地址总线说起从 Pentium Pro 处理器开始 CPU 的地址总线已经升级到 36 位寻址能力达到 64GB 按理说 CPU 支持 4GB 的内存是没有问题的; 因此芯片组(北桥—MCH)**地址总线的数量**就成了决定物理内存地址空间大小的决定性因素. 在 Intel 945 系列和 945 以前的芯片组 nForce 550 系列和 550 以前的芯片组都只有 32 条地址线为系统提供 4GB 的地址空间即最高可以安装 4GB 的内存条. 虽然可以安装 4GB 内存条但这 4GB 的内存空间不能全部纷配给内存因为**从 4GB 空间的顶端地址(FFFFFFFFh)开始向下要有 400MB-1GB 的地址空间要分配给主板上的其他物理内存**.

4GB 的地址空间可以分为两大部分**0MB~物理内存顶端的地址分配给主板上安装的物理内存****物理内存到 4GB 顶端的地址分配给 BIOS(ROM)和 PCI/PCI-E 设备的存储器**. 由于这些存储器基本上是用于系统的输入和输出所以 Intel 又把这段地址空间称之为"MMIO"(Memory Mapped I/OI/O 存储器映射). 当系统安装 3GB 以下的内存条时 MMIO 区域不会与物理内存条的地址空间相重叠操作系统可以访问几乎全部的物理内存而操作系统属性里显示的物理内存基本接近实际内存的容量. 而当系统安装上 4GB 内存时问题出现了. **由于位于 4GB 下面的部分地址空间要优先分配给 MMIO 内存条上对应的这段区间就得不到编址(和内存条没关系内存条再大也没用不会为其编址)**所以操作系统就不能使用. 严格意义上来说即使安装 2GB 内存时操作系统也不可能使用到全部的内存容量诸如传统 DOS 的 UMA 区就有部分被占用的地址空间但因为被占用的容量相比之下实在太少所以就被很多读者忽略了. **MMIO 占用的地址空间在 256MB~1GB 之间**这么大的"浪费"大家肯定不能"熟视无睹".

因为受 4GB 芯片组地址空间的限制(32 条地址线的限制)Intel 945 系列及以前的芯片组、NVIDIA nForce 550 及以前的芯片组都没有办法绕过这个限制. 具体原因有三方面:

- 其一是芯片组没有剩余空间分配来供操作系统来调配;

- 其二是物理内存的编址必须是连续的不能被割断;

- 其三是系统开机时必需先从 4GB 的顶端地址(FFFF_FFFFh)读取 BIOS 数据, 这是 IA32 架构和 4GB 地址空间的局限.

所以建议使用这些芯片组主板的用户不要安装 4GB 的内存这样会有部分内存容量不能被操作系统所使用. 而解决 4GB 内存限制的唯一办法就是扩展地址空间.

通过以上分析可知在 1G 显存和 3G 内存的机子配置下显存被优先的分配到了 4G 到 4G 以下的部分地址空间导致了内存的部分地址空间不能被使用.

## 3. 如何解决这个问题

要解决这个问题必须支持大于 4GB 内存的芯片组和采用"内存重映射"技术.

面对原有芯片组 4GB 内存的局限 Intel 和 NVIDIA 早就开始未雨绸缪他们对传统的 32 位地址总线进行了调整将其升级到 36 位并推出了一系列可以突破 4GB 内存限制的芯片组这就是 Intel 的 965 系列以及 975 系列、NVIDIA 的 nForce 570/590 以及 680 系列等等.

支持 4GB 以上内存的部分芯片组如图一所示.  从上面的芯片组参数来看**地址总线从 32 位提升到 36 位地址空间达到 64GB 支持安装 8GB 的物理内存**. 但由于 IA32 架构的规则是开机时必须从 4GB 的 FFFF_FFFFh 地址读取 BIOS 信息尽管芯片组支持的地址空间变大了且最大支持的物理内存容量也达到了 8GB(或以上)但从本质上来说仍然不能解决 MMIO 地址占用 4GB 内存编址的问题. 这要怎么办呢?

36 位地址总线最大可以支持 64GB 的地址空间这就为移动 MMIO 地址区提供了条件. 现在解决这个问题的办法就是"内存重映射"技术——就是在 IA32 架构的基础上把 BIOS(ROM)和 PCI/PCI-E 设备占用的 MMIO 地址区段重新映射到内存条顶端地址以上 (例如 4GB 以上)的地址空间从而把 IA32 架构规定的这一段操作系统不可使用的、位于 4GB 下面的 MMIO 地址空间回收给物理内存使用保证物理内存编址的连续性.

**"内存重映射"技术必须通过 BIOS 完成**. 所以 BIOS 必须具有支持内存重映射的功能模块以便根据用户安装的内存容量来确定是否需要启用内存重映射功能. 同时**在 BIOS 的设置选单中也要有"Memory Re-Mapping"的设置选项**使用 4GB 或者 4GB 以上内存的用户一定要将此项设置设为"Enable"

**解决 4GB 内存问题还需要操作系统支持**. 我们常使用的桌面操作系统是 32 位的支持 4GB 的地址空间. 前面介绍了解决 4GB 问题的芯片组是支持 64GB 地址空间的在这样的芯片组主板上安装 32 位的操作系统就只能使用 4GB 的地址空间因此安装 4GB 内存不能使用仅支持 4GB 地址空间的 32 位的操作系统. 应该使用支持大于 4GB 地址空间的 32 位操作系统或 64 位的操作系统.

## 4. 结论

1. 由于 iA32 架构要求 BIOS(ROM)芯片的地址 PCI、PCI-E 存储器地址、APCI 中断路由地址等必须占用从 4GB 开始以下的 256M-1GB 空间. 这段 MMIO 地址区不能分配给内存条. 4GB 的内存条有 256MB-1GB 的容量不能编址而浪费.

2. 使用 4GB 以上的内存条必须使用地址(编址)空间 64GB 的芯片组主板.

3. 内存重映射就是把被 MMIO 占用的地址移到内存条容量以上的地址空间.

4. BIOS 应具有支持"内存重映射"功能设置项里有 Memory Remap Feature 选项并设置为 Enable.

5. 必须安装寻址空间大于 4GB 的操作系统. 比如 Windows 2000 高级服务器版以及 64 位操作系统

6. 所有地址空间为 4GB 的芯片组(Intel945 和 nForce550 之前的)和 32 位操作系统均不能利用"内存重映射"技术解决 4GB 内存问题

7. 1G 的显卡和 3G 的内存相当于一个 4G 内存对地址空间的影响所以以上结论对其同样适用.