
PCI 与 PCI Express(PCle)总线在处理器系统中得到了大规模应用. PCISIG 也制定了一系列 PCI 与 PCI Express 总线相关的规范, 这些规范所涉及的内容庞杂广泛. 对于已经理解了 PCI 与 PCI Express 总线的工程师, 这些规范便于他们进一步获得必要的细节知识. 对于刚刚接触 PCI 与 PCI Express 总线的工程师, 这些规范性的文档并不适合阅读. 在阅读这些规范时, 工程师还需要具备一些与体系结构相关的基础知识, 这恰是规范并不涉及的内容. 对于多数工程师, 规范文档适于查阅, 而不便于学习.

本书将以处理器体系结构为主线介绍 PCI Express 总线的组成, 以便读者进一步理解 PCI Express 总线协议. 本书并不是关于 PCI 和 PCI Express 总线的百科全书, 因为读者完全可以通过阅读 PCI 和 PCI Express 总线规范获得细节信息. 本书侧重的是 PCI 和 PCI Express 总线中与处理器体系结构相关的内容.

本书不会对 PCI 总线的相关规范进行简单重复, 部分内容并不在 PCI 总线规范定义的范围内, 例如 HOST 主桥和 RC.PCI 总线规范并没有规定处理器厂商如何实现 HOST 主桥和 RC, 不同的处理器厂商实现的 HOST 主桥和 RC 有较大差异, 而这些内容正是本书所讨论的重点. 此外本书还讲述了一些在 PCI 总线规范中提及, 但是容易被忽略的一些重要概念.

本书共由三篇组成. 第 [篇(第 1~3 章) 介绍 PCI 总线的基础知识. 第 Ⅱ 篇 (第 4~13 章) 介绍 PCI Express 总线的相关概念. 第 Ⅱ 篇的内容以第]篇为基础. 从系统软件的角度来看, PCI Express 总线向前兼容 PCI 总线, 理解 PCI Express 总线必须建立在深刻理解 PCI 总线的基础之上. 读者需要按照顺序阅读这两篇.

第 1 章主要说明 PCI 总线涉及的一些基本知识. 有些知识稍显过时, 但是在 PCI 总线中出现的一些数据传送方式, 如 Posted, Non-Posted 和 Split 数据传送方式, 依然非常重要, 也是读者需要掌握的.

第 2 章重点介绍 PCI 桥. PCI 桥是 PCI 及 PCI Express 体系结构的精华所在, 本章还使用了一定篇幅介绍了非透明桥. 非透明桥不是 PCI 总线定义的标准桥片, 但是在处理器系统之间的互联中得到了广泛的应用.

第 3 章详细阐述 PCI 总线的数据传送方式, 与 Cache 相关的内容和预读机制是本章的重点. 目前 PCI 与 PCI Express 对预读机制的支持并不理想. 但是在可以预见的将来, PCI Express 总线将充分使用智能预读机制进一步提高总线的利用率.

第 4 章是 PCI Express 篇的综述. 第 5 章以 Intel 的笔记本平台 Montevina 为例说明 RC 的各个组成模块. 实际上 RC 这个概念, 只有在 x86 处理器平台中才真正存在. 其他处理器系统中, 并不存在严格意义上的 RC.

第 6, 7 章分别介绍 PCI Express 总线的事务层, 数据链路层和物理层. 物理层是 PCI Express 总线的真正核心, 也是中国工程师最没有机会接触的内容. 这也是我们这一代工程师的遗憾与无奈. 第 8 章简要说明了 PCI Express 总线的链路训练与电源管理.

第 9 章主要讨论的是通用流量控制的管理方法与策略. PCI Express 总线的流量控制机制仍需完善, 其中不等长的报文长度也是限制 PCI Express 总线流量控制进一步提高的重要因素.

第 10 章重点介绍 MSI 和 MSI-X 中断机制. MSI 中断机制在 PCI 总线中率先提出, 但是在 PCI Express 总线中也得到大规模普及. 目前 x86 架构多使用 MSI-X 中断机制, 而在许多嵌入式处理器中仍然使用 MSI 中断机制.

第 11 章的篇幅很短, 重点介绍 PCI 和 PCI Express 总线中的序. 有志于学习处理器体系结构的工程师务必掌握这部分内容. 在处理器体系结构中有关 Cache 和数据传送序的内容非常复杂, 掌握这些内容也是系统工程师进阶所必须的.

第 12 章讲述了笔者的一个实际设计 -- Capric 卡, 简单介绍了 Lnux 设备驱动程序的实现过程, 并对 PCI Express 总线的延时与带宽进行了简要分析.

第 13 章介绍 PCI 总线与虚拟化相关的一些内容. 虚拟化技术已崭露头角, 与虚拟化相关的一系列内容将对处理器体系结构产生深远的影响. 目前虚拟化技术已经在 x86 和 PowerPC 处理器中得到了广泛的应用.

第 Ⅲ 篇以 Linux 系统为实例说明 PCI 总线在处理器系统中的使用方法, 也许有许多读者对这一篇有着浓厚的兴趣. Linux 无疑是一个非常优秀的操作系统. 但是需要提醒系统工程师, Linux 系统仅是一个完全开源的操作系统. 对于有志于学习处理器体系结构的工程师学习 1inux 系统是必要的, 但是仅靠学习 Linux 系统并不足够.

通常说来, 理解处理器体系结构至少需要了解两三种处理器, 并了解它们在不同处理器上的实现. 尺有所短, 寸有所长. 不同的处理器和操作系统所应用的领域并不完全相同. 也是因为这个原因, 本书以 PowerPC 和 x86 处理器为基础对 PCI 和 PCI Express 总线进行说明.
