
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1 CPU 和指令集](#1-cpu-和指令集)
- [2 微架构](#2-微架构)
- [3 组装芯片](#3-组装芯片)
- [4 指令集的选择](#4-指令集的选择)
- [5 总结](#5-总结)
- [6 参考](#6-参考)

<!-- /code_chunk_output -->

随着智能设备的广泛普及这几年媒体上越来越多的出现关于"架构""ARM vs x86""芯片研发"的相关内容. 很多消费者和爱好者面对这些以往不太常见的信息时就会迷惑甚至产生误解. 其中一组比较容易被混淆的概念就是**CPU**、**架构**、**指令集**与**芯片**. 本文试图用较浅显的文字阐明它们的关系与区别纠正一些常见的错误认识与观点.

# 1 CPU 和指令集

学过计算机基础知识的朋友都知道 CPU 的含义亦即**中央处理器**是负责计算机主要运算任务的组件. 一般习惯把 CPU 比喻为人的大脑. 而了解略深的用户会听说 CPU 有 x86、ARM 等分类前者主要用于 PC 而后者主要用于手机平板等设备. 那么这里的**x86**、**ARM**指的是什么呢?

**CPU 执行计算任务**时都需要遵从**一定的规范**程序在**被执行前**都需要先**翻译**为**CPU 可以理解的语言**. 这种**规范或语言**就是**指令集(ISAInstruction Set Architecture**). 程序被按照**某种指令集的规范**翻译为**CPU 可识别的底层代码**的过程叫做**编译(compile**). **x86**、**ARM v8**、**MIPS**都是**指令集的代号**. **指令集**可以**被扩展**如**x86**增加**64 位支持**就有了**x86\-64**. 厂商开发兼容某种指令集的 CPU 需要**指令集专利持有者授权**典型例子如 Intel 授权 AMD 使后者可以开发**兼容 x86 指令集**的 CPU.

# 2 微架构

CPU 的**基本组成单元**即为**核心(core**). **多个核心**可以同时执行**多件计算任务**前提是这些任务没有先后顺序.

**核心的实现方式**被称为**微架构(microarchitecture**). 微架构的设计**影响**核心可以达到的**最高频率**、核心在**一定频率**下能执行的**运算量**、一定工艺水平下核心的**能耗水平**等等. 此外**不同微架构**执行各类程序的**偏向**也**不同**例如 90 年代末期 Intel 的 P6 微架构就在浮点类程序上表现优异但在整数类应用中不如同频下的对手.

常见的代号如**Haswell**、**Cortex\-A15**等都是**微架构的称号**. 注意**微架构**与**指令集**是两个概念: **指令集**是**CPU 选择的语言**而**微架构**是**具体的实现**. i7\-4770 的核心是**Haswell 微架构**这种微架构**兼容 x86 指令集**. 对于兼容 ARM 指令集的芯片来说这两个概念尤其容易混淆: **ARM 公司**将自己研发的指令集叫做**ARM 指令集**同时它还**研发具体的微架构**如**Cortex 系列**并对外授权. 但是**一款 CPU**使用了**ARM 指令集**不等于它就使用了**ARM 研发的微架构！！！**. Intel、高通、苹果、Nvidia 等厂商都自行开发了兼容 ARM 指令集的微架构同时还有许多厂商使用 ARM 开发的微架构来制造 CPU. 通常业界认为只有具备**独立的微架构研发能力**的企业才算具备了**CPU 研发能力**而是否使用自行研发的指令集无关紧要. 微架构的研发也是 IT 产业技术含量最高的领域之一.

数年前国产龙芯 CPU 获得 MIPS 授权的消息曾引起一阵风波龙芯相关负责人还曾出来解释. 龙芯是兼容 MIPS 指令集**微架构**部由中科院**自主研发的 CPU 系列**. 过去中科院资金不足所以没有 MIPS 指令集授权但是指令集的实现方式是公开的因而中科院可以在研发时选择兼容该指令集. 待资金充足买下授权后龙芯就可以合法在市面销售. 从这里我们可以知道厂商研发 CPU 时并**不需要获得指令集授权**就可以**获得指令集的相关资料与规范**指令集本身的技术含量并不是很高. 获得授权主要是为了**避免法律问题**. 然而**微架构**的**设计细节**是各家厂商**绝对保密**的而且由于其技术复杂即便获得相应文档也难以山寨. 不同厂商的微架构设计水平也有较大差异典型如 Intel 与 AMD 的对比前者在最近几年明显技高一筹.

# 3 组装芯片

**微架构研发**完成或者说**核心研发**完成接下来就是将其**组装为芯片**了. **过去的芯片**仅仅包括**CPU**部分如今大量的芯片集成了**CPU**、**GPU**、**IO**等多种**不同的功能组件**此时这种芯片就不是传统意义上的"CPU"了. 将各种功能组件**组装为芯片**的技术含量相比微架构研发来说是较低的因而业界能做此类工作的企业也数量较多.

在 PC 时代几大主要的 CPU 研发厂商都只是自己研制微架构自己用. 到了智能设备时代 ARM 公司的**微架构授权模式**兴起. ARM 自己**开发微架构**后将它们上架出售其他厂商可以拿这些**核心**组装为芯片来使用或销售. 由于这种模式对第三方的技术能力要求很低加上**ARM 的微架构**在**低功耗**领域表现优异这种模式获得了广泛成功. 如果你发现某款芯片标明使用了**Cortex 系列核心**则一定是**这种模式的产物**. 如前所述**仅仅从 ARM 购买微架构**来组装芯片的厂商是**不能**被称作**CPU 研发企业**的这些芯片也不能被称为"xx 厂商研发的 CPU". 典型如华为的**海思 920**、**三星 Exynos 5430**只能说是"**使用 ARM Cortex\-A15 核心的芯片**". 但是如果一款兼容 ARM 指令集的芯片使用了厂商自主研发的微架构情况就不同了. 高通骁龙 800、苹果 A7 就是这样的例子--它们分别使用了高通、苹果自主研发的 CPU.

# 4 指令集的选择

随着智能设备市场不断扩大 ARM 阵营也不断壮大. 占领智能设备领域后 ARM 阵营开始进入 PC、服务器与高性能计算领域. 先是 ARM 发布了**ARM v8 64 位指令集**规范接着是各大厂商纷纷开始研发**基于 ARM v8 的高性能微架构**. 有人会问**ARM 指令集**不是为**低功耗设备**研发的吗?怎么现在又开始做高性能 CPU 了呢?多年以前这样的怀疑是很有道理的因为彼时**不同指令集**对**微架构**的影响还比较大 ARM 适合低功耗 x86 适合 PCPower 适合小型机......这类区分是存在的. 但是随着技术进步**指令集对微架构的影响已经小到可以忽略**任何指令集都可以做出适合不同领域的优秀微架构来. 因此用户看到**x86 指令集的手机 cpu**或是**ARM 指令集的服务器 CPU**都无需惊讶这是技术发展的自然结果.

那么现在各家 CPU 研发厂商选择**指令集的标准**又是什么呢?业界除了**x86**和**ARM**、**MIPS**其实还有一大堆**各种各样的指令集**. 比如**小型主机**领域的**Sparc**、**Alpha**、**Power**等. 国内几家研 CPU 的科研机构就分别选择了 x86、MIPS、Sparc、Alpha、ARM 指令集早年甚至有机构选择 Intel 没落的**Itanium**使用的**EPIC 指令集**的. 一般来说大家倾向于选择**软件生态较好的指令集**--前面说过**软件必须编译**后才能在**某种指令集平台**上运行而**编译是很复杂**的事情绝大多数**闭源软件**仅仅会对**少数一两个平台编译**. 因而**支持某种指令集的软件应用越多**这种**指令集也就越有市场优势**--**新开发的微架构**只需要**兼容某种指令集**那么就可以很容易运行大量为其开发的软件. 早年因为**微软的强势**与**Wintel 联盟**的推动**x86 指令集**成了最受欢迎的角色帮助 Intel 用彼时性能相对落后的微架构在 PC 平台挤跑了一众对手. 后 PC 时代由于**苹果谷歌**的**两大操作系统平台**的推动**ARM 指令集**又取得了绝对的市场优势. 但对于**新的 CPU 研发单位**来说他们想获得**热门指令集的兼容授权**是很困难的事情. 以前**x86**与**ARM 的指令集授权**是拿钱**买不到的**想要得到都需要进行**高水平专利交换**. 拿到**x86 授权**的几家厂商要么是**拿的早**(**AMD、Cyrix、IDT**)要么是有**高水平技术**与 Intel 交易(**Transmeta**以**功耗控制技术**同 Intel 交易). 后来**Nvidia**想要**研发自己的 CPU**找 Intel 软磨硬泡后者就是不给搞得 Nvidia 相当无奈. 国内的研发单位当年开始研究时自知不可能拿到 x86 授权于是各自去找关系好些的其他授权方解决问题了. **ARM**这边也一直对**指令集授权**卡的很死之前只有**高通**、**博通**和**Intel**得到也是通过技术交换的形式. 08 年**苹果**乔帮主被 Intel 甩脸色后决定自己搞 CPU 最后也拿到了**ARM 的许可**想来彼时老乔也是威逼利诱硬是让 ARM 屈服了(毕竟指令集多授权一家就多个对手啊). 后来 ARM 对指令集授权也放松了去年**三星**与**华为**也分别得到了授权他们的自研 CPU 预计也将在未来一两年面世.

# 5 总结

本文总结下来的内容很简单: **指令集**与**微架构**是**不同**的概念不可混淆; **CPU 研发**指的是**微架构研发**; 如今指令集不再有"最适合领域"的说法.

也就是说: 说**cpu**就基本等于说**微架构**

# 6 参考

https://zhuanlan.zhihu.com/p/19893066