
本书的实验例子可运行在三种环境中.

⓵ **Bochs 模拟器**: 任何支持 x64 的版本都可以

⓶ **VMware 虚拟机**

⓷ **真实机器**上

本书很多实验**只能在真实机器**上运行, Bochs 和 VMware 并不能支持那些功能.

>问题 1: 使用软盘还是 U 盘? 甚至是硬盘?

在 Bochs 中可以使用软盘或硬盘的映像(image)文件, 在真实机器上我们可以使用 U 盘作为介质启动计算机运行实验程序. 本书例子运行使用以下三种介质.

⓵ 软盘映像: 统一使用文件名为**demo.img**, 可以在**bochs**或**vmware**里运行.

⓶ 硬盘映像: 统一使用文件名为**c.img**, 可以在**bochs**里运行

⓷ U 盘: 将生成的硬盘映像直接写入 U 盘, 在**真实机器**上运行.

因此, 本书例子最终生成**两个映像文件**: demo.img 用于 bochs 或 vmware 里运行; c.img 用于在 bochs 或真实机器上运行.

# 使用 FAT32 文件格式

在使用**软盘启动**时, 我们直接将**boot 代码**写在**MBR**里. 而当使用 U 盘启动时会遇到一些麻烦, 我们的代码写在 MBR 里, 某些机器将启动不了.

因此, 当使用 U 盘在真实机器上测试时, 将使用 FAT32 文件格式, 也就是**硬盘映像 c.img**使用**FAT32 文件格式**.

如下,对于软盘映像(demo.img)和硬盘映像(c.img), 两种文件组织形式

![2019-11-30-19-44-34.png](./images/2019-11-30-19-44-34.png)

⓵ 软盘映像文件(demo.img): 将**boot 模块**直接写入**软盘的 0 扇区**, 那么 boot 代码就是我们的 MBR 程序, **BIOS**将读软盘的**0 扇区**(**boot 代码**)到内存的**7c00h**位置.

⓶ 硬盘映像文件(c.img)和 U 盘: 将**boot 模块**写入**映像文件和 U 盘**的**63 号扇区**, **BIOS**读取**硬盘或 U 盘**的**0 扇区**(这是 FAT32 文件格式启动盘生成的**MBR 代码**)代码到**内存 7c00h**, 然后再由这个 MBR 代码来从 63 号扇区读取我们的 boot 程序.

无论如何, boot 程序最终是运行在 7c00h 区域里, boot 程序的职责是负责加载后续的模式(包括 lib16、lib32、lib64、protected 和 long 模式).

